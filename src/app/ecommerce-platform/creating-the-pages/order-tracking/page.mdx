import BackToTop from "@/components/BackToTop";

# The Order Tracking Page

## Table of Contents

## The `import` Statements and Interface

```tsx
// src/app/track-order/page.tsx
"use client";

import { useCurrency } from "@/app/context/currencyContext";
import { Order, useOrder } from "@/app/context/orderContext";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Separator } from "@/components/ui/separator";
import { formatDate } from "@/lib/utils/format";
import { getStatusColor, getStatusIcon } from "@/lib/utils/orders.tsx";
import {
  AlertCircle,
  Calendar,
  Copy,
  ExternalLink,
  MapPin,
  Package,
  Search,
  Truck,
} from "lucide-react";
import Image from "next/image";
import Link from "next/link";
import { useSearchParams } from "next/navigation";
import { Suspense, useEffect, useState } from "react";
import { toast } from "sonner";

interface TrackingEvent {
  date: Date;
  location: string;
  status: string;
  description: string;
}
```

## Storing the Data

```tsx
// src/app/track-order/page.tsx
function TrackOrderContent() {
  const searchParams = useSearchParams();
  const initialTracking = searchParams.get("tracking") || "";

  const { getOrderByTrackingNumber, orders } = useOrder();
  const { formatPrice } = useCurrency();

  const [trackingNumber, setTrackingNumber] = useState(initialTracking);
  const [order, setOrder] = useState<Order | null>(null);
  const [isSearching, setIsSearching] = useState(false);
  const [searchAttempted, setSearchAttempted] = useState(false);
```

## Generating Tracking Events

```tsx
// src/app/track-order/page.tsx
const generateTrackingEvents = (order: Order): TrackingEvent[] => {
  const events: TrackingEvent[] = [];
  const orderDate = new Date(order.orderDate);

  // Order placed event
  events.push({
    date: orderDate,
    location: "Order Processing Center",
    status: "Order Placed",
    description: "Your order has been received and is being processed.",
  });

  // Based on order status, add appropriate events
  if (["processing", "shipped", "delivered"].includes(order.status)) {
    const processingDate = new Date(orderDate);
    processingDate.setDate(orderDate.getDate() + 1);
    events.push({
      date: processingDate,
      location: "Fulfillment Center",
      status: "Processing",
      description: "Your order is being prepared for shipment.",
    });
  }

  if (["shipped", "delivered"].includes(order.status)) {
    const shippedDate = new Date(orderDate);
    shippedDate.setDate(orderDate.getDate() + 2);
    events.push({
      date: shippedDate,
      location: "Shipping Facility",
      status: "Shipped",
      description: `Package has been shipped via ${order.shippingCarrier}.`,
    });
  }

  if (order.status === "delivered") {
    const deliveredDate = new Date(orderDate);
    deliveredDate.setDate(orderDate.getDate() + 5);
    events.push({
      date: deliveredDate,
      location: "Destination",
      status: "Delivered",
      description: "Package has been successfully delivered.",
    });
  }

  return events.sort((a, b) => b.date.getTime() - a.date.getTime());
};
```

### Explanation of the Code

This function generates a list of tracking events based on the order's status and date. It creates events for when the order is placed, processed, shipped, and delivered, providing a timeline of the order's journey.

## Handling Search

```tsx
// src/app/track-order/page.tsx
useEffect(() => {
  if (initialTracking) {
    handleSearch(initialTracking);
  }
}, [initialTracking]);

const handleSearch = (trackingNum?: string) => {
  const searchTerm = trackingNum || trackingNumber;
  if (!searchTerm.trim()) {
    toast.error("Please enter a tracking number");
    return;
  }

  setIsSearching(true);
  setSearchAttempted(true);

  // Simulate API delay
  setTimeout(() => {
    const foundOrder = getOrderByTrackingNumber(searchTerm.trim());
    setOrder(foundOrder);

    if (foundOrder) {
      toast.success("Order found!");
    } else {
      toast.error("No order found with this tracking number");
    }

    setIsSearching(false);
  }, 1000);
};
```

### Explanation of the Code

This code handles the search functionality for tracking orders. It checks if a tracking number is provided, simulates an API call to find the order, and updates the state accordingly. If an order is found, it displays a success message; otherwise, it shows an error.

## Enabling Copying

```tsx
// src/app/track-order/page.tsx
const copyTrackingNumber = () => {
  if (order?.trackingNumber) {
    navigator.clipboard.writeText(order.trackingNumber);
    toast.success("Tracking number copied!");
  }
};
```

### Explanation of the Code

This function allows users to copy the tracking number to their clipboard. It uses the Clipboard API and provides feedback via a toast notification.

## Displaying the Tracking Information

```tsx
// src/app/track-order/page.tsx
  return (
    <div className="min-h-screen">
      <div className="mx-auto px-6 lg:px-8 py-12 max-w-7xl">
        {/* Header */}
        <div className="mb-8">
          <h1 className="mb-2 font-bold text-3xl">Track Your Order</h1>
          <p className="text-muted-foreground">
            Enter your tracking number to see the current status of your
            shipment
          </p>
        </div>

        {/* Search Section */}
        <Card className="mb-8">
          <CardHeader>
            <CardTitle className="flex items-center">
              <Search className="mr-2 w-5 h-5" />
              Track Package
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="flex sm:flex-row flex-col gap-4">
              <div className="flex-1">
                <Label htmlFor="tracking">Tracking Number</Label>
                <Input
                  id="tracking"
                  placeholder="Enter your tracking number (e.g., TRK1234567890AB)"
                  value={trackingNumber}
                  onChange={(e) => setTrackingNumber(e.target.value)}
                  onKeyDown={(e) => e.key === "Enter" && handleSearch()}
                  className="mt-1"
                />
              </div>
              <div className="flex items-end">
                <Button
                  onClick={() => handleSearch()}
                  disabled={isSearching || !trackingNumber.trim()}
                  variant={isSearching ? "classic" : "modern"}
                  className="w-full sm:w-auto"
                >
                  {isSearching ? (
                    <>
                      <div className="mr-2 border-b-2 rounded-full w-4 h-4 animate-spin"></div>
                      Searching...
                    </>
                  ) : (
                    <>
                      <Search className="mr-2 w-4 h-4" />
                      Track Package
                    </>
                  )}
                </Button>
              </div>
            </div>

            {searchAttempted && !order && (
              <div className="bg-yellow-50 mt-4 p-4 border border-yellow-200 rounded-lg">
                <div className="flex items-center">
                  <AlertCircle className="mr-2 w-5 h-5 text-yellow-600" />
                  <div>
                    <p className="font-medium text-sm text-yellow-800">
                      Order not found
                    </p>
                    <p className="text-sm text-yellow-700">
                      Please check your tracking number and try again. Tracking
                      numbers are case-sensitive.
                    </p>
                  </div>
                </div>
              </div>
            )}
          </CardContent>
        </Card>

        {/* Order Details */}
        {order && (
          <div className="gap-8 grid grid-cols-1 lg:grid-cols-3">
            {/* Main Content */}
            <div className="space-y-6 lg:col-span-2">
              {/* Order Status */}
              <Card>
                <CardHeader>
                  <CardTitle className="flex justify-between items-center">
                    <span className="flex items-center">
                      {getStatusIcon(order.status)}
                      <span className="ml-2">Order Status</span>
                    </span>
                    <Badge variant={`${getStatusColor(order.status)}`}>
                      {order.status}
                    </Badge>
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="flex justify-between items-center bg-muted p-4 rounded-lg">
                      <div>
                        <p className="text-muted-foreground text-sm">
                          Tracking Number
                        </p>
                        <p className="font-mono font-semibold text-lg">
                          {order.trackingNumber}
                        </p>
                      </div>
                      <Button
                        variant="outline"
                        size="sm"
                        onClick={copyTrackingNumber}
                        className="gap-2"
                      >
                        <Copy className="w-4 h-4" />
                        Copy
                      </Button>
                    </div>

                    <div className="gap-4 grid grid-cols-1 md:grid-cols-2">
                      <div className="p-4 border rounded-lg">
                        <div className="flex items-center space-x-2 mb-2">
                          <Calendar className="w-4 h-4 text-muted-foreground" />
                          <span className="font-medium text-sm">
                            Order Date
                          </span>
                        </div>
                        <p className="text-muted-foreground text-sm">
                          {formatDate(order.orderDate)}
                        </p>
                      </div>

                      <div className="p-4 border rounded-lg">
                        <div className="flex items-center space-x-2 mb-2">
                          <Truck className="w-4 h-4 text-muted-foreground" />
                          <span className="font-medium text-sm">
                            Estimated Delivery
                          </span>
                        </div>
                        <p className="text-muted-foreground text-sm">
                          {formatDate(order.estimatedDelivery)}
                        </p>
                      </div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Tracking Timeline */}
              <Card>
                <CardHeader>
                  <CardTitle>Tracking Timeline</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    {generateTrackingEvents(order).map((event, index) => (
                      <div key={index} className="flex items-start space-x-4">
                        <div className="flex flex-col items-center">
                          <div
                            className={`w-8 h-8 rounded-full flex items-center justify-center ${
                              index === 0
                                ? "text-primary-foreground"
                                : "bg-muted text-muted-foreground"
                            }`}
                          >
                            {index === 0 ? (
                              getStatusIcon(event.status)
                            ) : (
                              <div className="bg-current rounded-full w-2 h-2" />
                            )}
                          </div>
                          {index < generateTrackingEvents(order).length - 1 && (
                            <div className="bg-muted mt-2 w-px h-12" />
                          )}
                        </div>
                        <div className="flex-1 pb-4">
                          <div className="flex justify-between items-center mb-1">
                            <p className="font-medium">{event.status}</p>
                            <p className="text-muted-foreground text-sm">
                              {formatDate(event.date)}
                            </p>
                          </div>
                          <p className="mb-1 text-muted-foreground text-sm">
                            {event.location}
                          </p>
                          <p className="text-sm">{event.description}</p>
                        </div>
                      </div>
                    ))}
                  </div>
                </CardContent>
              </Card>

              {/* Shipping Address */}
              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center">
                    <MapPin className="mr-2 w-5 h-5" />
                    Shipping Address
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-sm">
                    <p className="font-medium">{order.customerName}</p>
                    <p className="text-muted-foreground">
                      {order.shippingAddress}
                    </p>
                    <p className="text-muted-foreground">
                      {order.customerEmail}
                    </p>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* Order Summary Sidebar */}
            <div className="space-y-6 lg:col-span-1">
              <Card>
                <CardHeader>
                  <CardTitle>Order Summary</CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="text-sm">
                    <p className="mb-2 font-medium">Order #{order.id}</p>
                    <p className="text-muted-foreground">
                      {order.items.length} item
                      {order.items.length !== 1 ? "s" : ""}
                    </p>
                  </div>

                  <Separator />

                  <div className="flex justify-between">
                    <span>Total</span>
                    <span className="font-semibold">
                      {formatPrice(order.grandTotal)}
                    </span>
                  </div>

                  <div className="space-y-3 pt-4">
                    <Button asChild className="w-full">
                      <Link href={`/checkout/confirmation?orderId=${order.id}`}>
                        View Order Details
                      </Link>
                    </Button>

                    <Button asChild variant="outline" className="w-full">
                      <Link href="/support">Contact Support</Link>
                    </Button>
                  </div>
                </CardContent>
              </Card>

              {/* Order Items Preview */}
              <Card>
                <CardHeader>
                  <CardTitle>Items in This Order</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    {order.items.slice(0, 3).map((item) => (
                      <div
                        key={item.id}
                        className="flex items-center space-x-3"
                      >
                        <div className="flex justify-center items-center bg-muted rounded-lg w-12 h-12">
                          {item.thumbnail ? (
                            <Image
                              src={item.thumbnail}
                              alt={item.title}
                              className="rounded-lg w-full h-full object-cover"
                              width={48}
                              height={48}
                              loading="lazy"
                            />
                          ) : (
                            <Package className="w-6 h-6 text-muted-foreground" />
                          )}
                        </div>
                        <div className="flex-1 min-w-0">
                          <p className="font-medium text-sm truncate">
                            {item.title}
                          </p>
                          <p className="text-muted-foreground text-sm">
                            Qty: {item.quantity}
                          </p>
                        </div>
                      </div>
                    ))}
                    {order.items.length > 3 && (
                      <p className="text-muted-foreground text-sm">
                        +{order.items.length - 3} more items
                      </p>
                    )}
                  </div>
                </CardContent>
              </Card>
            </div>
          </div>
        )}

        {/* Recent Orders (if no order is being tracked) */}
        {!order && orders.length > 0 && (
          <Card>
            <CardHeader>
              <CardTitle>Recent Orders</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                {orders.slice(0, 5).map((recentOrder) => (
                  <div
                    key={recentOrder.id}
                    className="flex justify-between items-center hover:bg-muted/50 p-4 border rounded-lg cursor-pointer"
                    onClick={() =>
                      setTrackingNumber(recentOrder.trackingNumber)
                    }
                  >
                    <div>
                      <p className="font-medium">Order #{recentOrder.id}</p>
                      <p className="text-muted-foreground text-sm">
                        {formatDate(recentOrder.orderDate)} •{" "}
                        {recentOrder.items.length} items
                      </p>
                    </div>
                    <div className="text-right">
                      <Badge variant={`${getStatusColor(recentOrder.status)}`}>
                        {recentOrder.status}
                      </Badge>
                      <p className="text-muted-foreground text-sm">
                        {recentOrder.trackingNumber}
                      </p>
                    </div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        )}

        {/* Help Section */}
        <Card className="mt-8">
          <CardHeader>
            <CardTitle>Need Help?</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="gap-6 grid grid-cols-1 md:grid-cols-2">
              <div>
                <h3 className="mb-2 font-semibold">Tracking Issues</h3>
                <p className="mb-3 text-muted-foreground text-sm">
                  If you're having trouble tracking your order, here are some
                  things to check:
                </p>
                <ul className="space-y-1 text-muted-foreground text-sm">
                  <li>• Make sure your tracking number is entered correctly</li>
                  <li>• Tracking information may take 24-48 hours to appear</li>
                  <li>• Check your email for shipping confirmations</li>
                </ul>
              </div>

              <div>
                <h3 className="mb-2 font-semibold">Contact Support</h3>
                <p className="mb-3 text-muted-foreground text-sm">
                  Our customer service team is here to help with any questions.
                </p>
                <div className="space-y-2">
                  <Button
                    asChild
                    variant="outline"
                    size="sm"
                    className="w-full"
                  >
                    <Link href="/support">
                      <ExternalLink className="mr-2 w-4 h-4" />
                      Contact Support
                    </Link>
                  </Button>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

### Explanation of the Code

This section renders the main content of the tracking page, including the search input, order details, tracking timeline, shipping address, and order summary. It uses various components like `Card`, `CardHeader`, and `CardContent` to structure the layout. The page also includes buttons for copying the tracking number and viewing recent orders.

## Next Steps

Even with a seamless shopping experience, there will be occasions when customers need to return a product. Providing a clear, user-friendly return process is crucial for maintaining customer satisfaction and building trust in your e-commerce platform.

To address this, let’s [create the return page](/ecommerce-platform/creating-the-pages/returns), where users can:

- **Initiate a return request**:
  Allow customers to select the order and specific items they wish to return, specifying reasons such as defects, wrong size, or changed mind.

- **Review return policies**:
  Clearly communicate your platform’s return guidelines, including timeframes, condition requirements, and refund procedures.

- **Schedule return shipping**:
  Provide options for printing return labels, arranging carrier pickups, or dropping off items at designated locations.

- **Track return status**:
  Enable users to monitor the progress of their return request and refund processing, keeping them informed every step of the way.

- **Contact support**:
  Offer easy access to customer service for any questions or issues during the return process.

Design the return page to be intuitive, accessible, and visually consistent with your overall site design. A straightforward returns process not only enhances the customer experience but also reinforces confidence in your brand, encouraging repeat business.

<BackToTop />
